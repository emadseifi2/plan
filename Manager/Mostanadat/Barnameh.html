<ul id="StatusSummary" style="display: none;">


    <!-- این قسمت برای الگوی نمایش -->
    <li data-id="[CATEGORY]" data-countregion="[COUNTREGION]" data-numberrulings="[NUMBERRULINGS]" data-title="[TITLE]"
        data-numberindex="[NUMBERINDEX]" data-typestatus="[TYPESTATE]" data-realization="[REALIZATION]"
        data-notrealization="[NOTREALIZATION]"></li>


</ul>
<style>
    .work-process-section-solar-classic {
        padding: 0;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
    }

    td {
        background-color: transparent !important;
    }
</style>
<section class="work-process-section-solar-classic">
    <div class="container-fluid p-0">
        <div class="row justify-content-center align-items-center">
            <div class="col t-center">
                <div class="divider divider-success divider-dotted text-center">
                    <div class="divider-text t-x16 t-bold">
                        خلاصه وضعیت تعداد احکام ، شاخص ها و فصول برنامه
                    </div>
                </div>
                <table class="table w-90 mx-auto">
                    <thead>
                        <tr>
                            <th class="bgc-success t-white t-x14"
                                style="text-align: center;border-top-right-radius: 5px;">فصول ماموریتی</th>
                            <th class="bgc-success t-white t-x14" style="text-align: center">تعداد بخش</th>
                            <th class="bgc-success t-white t-x14" style="text-align: center">تعداد احکام</th>
                            <th class="bgc-success t-white t-x14"
                                style="text-align: center;border-top-left-radius: 5px;">تعداد شاخص</th>
                        </tr>
                    </thead>
                    <tbody id="tbodyahkam"></tbody>
                </table>
                <hr />
                <div class="divider divider-success divider-dotted text-center">
                    <div class="divider-text t-x16 t-bold">
                        میزان تحقق 42 ماهه احکام و شاخص های برنامه
                    </div>
                </div>
                ...
                <hr />
                <div class="divider divider-success divider-dotted text-center">
                    <div class="divider-text t-x16 t-bold">
                        مقایسه پیشرفت دوسالانه ، سه سالانه و سه ساله و نیم
                    </div>
                </div>
                <div id="ColumnChartDiv" style="direction: ltr; height: 50vh" class="w-100"></div>
            </div>
            <div class="col t-center">
                <div class="divider divider-success divider-dotted text-center">
                    <div class="divider-text t-x16 t-bold">
                        خلاصه وضعیت شاخص های برنامه به تفکیک متولی
                    </div>
                </div>
                <table class="table w-80 mx-auto">
                    <thead>
                        <tr>
                            <th class="bgc-success t-white t-x14"
                                style="text-align: center;border-top-right-radius: 5px;">حوزه تخصصی</th>
                            <th class="bgc-success t-white t-x14" style="text-align: center">تعداد شاخص</th>
                            <th class="bgc-success t-white t-x14"
                                style="text-align: center;border-top-left-radius: 5px;">درصد تحقق</th>
                        </tr>
                    </thead>
                    <tbody id="tbodyshakhes"></tbody>
                </table>
                <hr />
                <div class="divider divider-success divider-dotted text-center">
                    <div class="divider-text t-x16 t-bold">
                        عملکرد شاخص های برنامه به تفکیک متولی
                    </div>
                </div>
                <div id="RadarChartDiv" style="direction: ltr; height: 50vh" class="w-100"></div>
            </div>
            <div class="col t-center">
                <div class="row justify-content-center align-items-center">
                    <div class="col t-center">
                        <img src="/portals/2/Econet/Image/Subject/3.png" class="img-fluid mx-auto"
                            style="height: 10vh;">
                        <h1 class="t-center t-x16 t-success">
                            هوشمندسازی و بهبود مدیریت
                        </h1>
                    </div>
                    <div class="col t-center">
                        <div id="PieChart_1" style="direction: ltr; height: 19vh" class="w-100"></div>
                    </div>
                </div>
                <hr class="my-1" />
                <div class="row justify-content-center align-items-center">
                    <div class="col t-center">
                        <img src="https://plan.tehran.ir/portals/2/Econet/Image/Subject/4.png" class="img-fluid mx-auto"
                            style="height: 10vh;">
                        <h1 class="t-center t-x16 t-success">
                            مسائل اجتماعی و فرهنگی </h1>
                    </div>
                    <div class="col t-center">
                        <div id="PieChart_2" style="direction: ltr; height: 19vh" class="w-100"></div>
                    </div>
                </div>
                <hr class="my-1" />
                <div class="row justify-content-center align-items-center">
                    <div class="col t-center">
                        <img src="https://plan.tehran.ir/portals/2/Econet/Image/Subject/1.png" class="img-fluid mx-auto"
                            style="height: 10vh;">
                        <h1 class="t-center t-x16 t-success">
                            ایمنی شهر و بافت فرسوده </h1>
                    </div>
                    <div class="col t-center">
                        <div id="PieChart_3" style="direction: ltr; height: 19vh" class="w-100"></div>
                    </div>
                </div>
                <hr class="my-1" />
                <div class="row justify-content-center align-items-center">
                    <div class="col t-center">
                        <img src="https://plan.tehran.ir/portals/2/Econet/Image/Subject/6.png" class="img-fluid mx-auto"
                            style="height: 10vh;">
                        <h1 class="t-center t-x16 t-success">
                            محیط زیست و آلودگی هوا </h1>
                    </div>
                    <div class="col t-center">
                        <div id="PieChart_4" style="direction: ltr; height: 19vh" class="w-100"></div>
                    </div>
                </div>
                <hr class="my-1" />
                <div class="row justify-content-center align-items-center">
                    <div class="col t-center">
                        <img src="https://plan.tehran.ir/portals/2/Econet/Image/Subject/5.png" class="img-fluid mx-auto"
                            style="height: 10vh;">
                        <h1 class="t-center t-x16 t-success">
                            حمل و نقل و ترافیک
                        </h1>
                    </div>
                    <div class="col t-center">
                        <div id="PieChart_5" style="direction: ltr; height: 19vh" class="w-100"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    let _shakhesTemplating = (_data) => {
        const template = [];
        for (let i = 0; i < _data.length; i++) {
            const element = _data[i];
            template.push('<tr>');
            template.push('<td class="t-center t-x12 py-1">');
            template.push(element.title);
            template.push('</td>');
            template.push('<td class="t-center t-x12 py-1">');
            template.push(element.numberindex);
            template.push('</td>');
            template.push('<td class="t-center t-x12 py-1">');
            template.push(element.realization);
            template.push('</td>');
        }
        return template.join('');
    };

    let _ahkamTemplating = (_data) => {
        const template = [];
        for (let i = 0; i < _data.length; i++) {
            const element = _data[i];
            template.push('<tr>');
            template.push('<td class="t-center t-x12 py-1">');
            template.push(element.title);
            template.push('</td>');
            template.push('<td class="t-center t-x12 py-1">');
            template.push(element.countregion);
            template.push('</td>');
            template.push('<td class="t-center t-x12 py-1">');
            template.push(element.numberrulings);
            template.push('</td>');
            template.push('<td class="t-center t-x12 py-1">');
            template.push(element.realization);
            template.push('</td>');
        }
        return template.join('');
    };

    const _dataCreation = (_filter) => {
        return [...document.querySelectorAll("#StatusSummary li")]
            .filter((li) => li.dataset.typestatus === _filter)
            .map((li) => {
                const title = li.dataset.title?.trim() || "";
                return {
                    title,
                    countregion: Number(li.dataset.countregion),
                    numberrulings: Number(li.dataset.numberrulings),
                    numberindex: Number(li.dataset.numberindex),
                    typestatus: li.dataset.typestatus,
                    realization: Number(li.dataset.realization),
                    notrealization: Number(li.dataset.notrealization)
                };
            });
    }

    let _variableHeight3DPieChart = (_pieChart, _data) => {
        // Themes begin
        am4core.useTheme(am4themes_animated);
        // Themes end

        // ایجاد نمونه‌ی نمودار
        var chart = am4core.create(_pieChart, am4charts.PieChart);
        chart.paddingLeft = 0;
        chart.paddingRight = 0;
        chart.paddingTop = 0;
        chart.paddingBottom = 0;
        // اضافه کردن سری و تنظیمات آن
        var pieSeries = chart.series.push(new am4charts.PieSeries());
        pieSeries.dataFields.value = "valuechart";
        pieSeries.dataFields.category = "titlechart";

        // حفره در نمودار به اندازه‌ی ۳۰٪ شعاع
        chart.innerRadius = am4core.percent(40);

        // تنظیم رنگ و استایل لبه‌های قطعات
        pieSeries.slices.template.stroke = am4core.color("#fff");
        pieSeries.slices.template.strokeWidth = 1;
        pieSeries.slices.template.strokeOpacity = 0.5;
        pieSeries.slices.template.cursorOverStyle = [{ property: "cursor", value: "pointer" }];

        pieSeries.alignLabels = false;
        pieSeries.labels.template.bent = true;
        pieSeries.labels.template.radius = 3;
        pieSeries.labels.template.padding(1, 1, 2, 1);
        pieSeries.labels.template.fill = am4core.color("#3f3f3f");
        pieSeries.ticks.template.disabled = true;
        //pieSeries.labels.template.text = "{value}"; // فقط مقدار valuechart را نمایش می‌دهد
        pieSeries.labels.template.text = "{value.percent.formatNumber('#.0')}%"; // نمایش درصد
        //pieSeries.labels.template.inside = true; // قرار دادن لیبل در داخل قطعات
        pieSeries.labels.template.fontSize = '10px';

        // تنظیمات سایه برای حالت hover
        var shadow = pieSeries.slices.template.filters.push(new am4core.DropShadowFilter());
        shadow.opacity = 0;

        var hoverState = pieSeries.slices.template.states.getKey("hover");
        var hoverShadow = hoverState.filters.push(new am4core.DropShadowFilter());
        hoverShadow.opacity = 0.7;
        hoverShadow.blur = 5;

        // دریافت رنگ از داده‌های ورودی
        pieSeries.slices.template.propertyFields.fill = "color";

        // تنظیم داده‌های نمودار
        chart.data = _data;
        chart.rtl = true;
    };

    let ColumnChart = (_chartData) => {

        am4core.ready(function () {
            // Create chart instance
            var chart = am4core.create("ColumnChartDiv", am4charts.XYChart);
            chart.paddingLeft = 0;
            chart.paddingRight = 0;
            chart.paddingTop = 0;
            chart.paddingBottom = 0;
            // Add data
            chart.data = _chartData;

            // Create axes
            var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
            categoryAxis.dataFields.category = "project";
            categoryAxis.renderer.grid.template.location = 0;
            categoryAxis.renderer.minGridDistance = 30;
            categoryAxis.renderer.labels.template.horizontalCenter = "middle";
            categoryAxis.renderer.labels.template.verticalCenter = "middle";
            categoryAxis.renderer.labels.template.rotation = 45;
            categoryAxis.renderer.labels.template.fontSize = 2;

            categoryAxis.tooltip.disabled = true;
            categoryAxis.renderer.minHeight = 10;

            var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
            valueAxis.renderer.minWidth = 50;

            // Create series
            var series = chart.series.push(new am4charts.ColumnSeries());
            series.sequencedInterpolation = true;
            series.dataFields.valueY = "progres";
            series.dataFields.categoryX = "project";
            series.tooltipText = "[{categoryX}: bold]{valueY}[/]";
            series.columns.template.strokeWidth = 0;
            series.tooltip.pointerOrientation = "vertical";
            series.columns.template.column.cornerRadiusTopLeft = 10;
            series.columns.template.column.cornerRadiusTopRight = 10;
            series.columns.template.column.fillOpacity = 0.8;

            var labelBullet = series.bullets.push(new am4charts.LabelBullet());
            labelBullet.label.verticalCenter = "bottom";
            labelBullet.label.dy = -10;
            labelBullet.label.text = "{values.valueY.workingValue.formatNumber('#.')}";

            // on hover, make corner radiuses bigger
            var hoverState = series.columns.template.column.states.create("hover");
            hoverState.properties.cornerRadiusTopLeft = 0;
            hoverState.properties.cornerRadiusTopRight = 0;
            hoverState.properties.fillOpacity = 1;

            series.columns.template.adapter.add("fill", function (fill, target) {
                return am4core.color(target.dataItem.dataContext.color);
            });

            // Cursor
            chart.cursor = new am4charts.XYCursor();

        }); // end am4core.ready()s
    }

    let _radarChart = (_chartData) => {
        am4core.ready(function () {
            // Create chart instance
            var chart = am4core.create("RadarChartDiv", am4charts.RadarChart);
            chart.paddingLeft = 0;
            chart.paddingRight = 0;
            chart.paddingTop = 0;
            chart.paddingBottom = 0;
            // Add data
            chart.data = _chartData;

            // Make chart not full circle
            chart.startAngle = -90;
            chart.endAngle = 180;
            chart.innerRadius = am4core.percent(20);

            // Set number format
            chart.numberFormatter.numberFormat = "#.#'%'";

            // Create axes
            var categoryAxis = chart.yAxes.push(new am4charts.CategoryAxis());
            categoryAxis.dataFields.category = "category";
            categoryAxis.renderer.grid.template.location = 0;
            categoryAxis.renderer.grid.template.strokeOpacity = 0;
            categoryAxis.renderer.labels.template.horizontalCenter = "right";
            categoryAxis.renderer.labels.template.fontWeight = 400;
            categoryAxis.renderer.labels.template.fontSize = "10em";           
            categoryAxis.renderer.labels.template.fontSize = "10px";           

            categoryAxis.renderer.labels.template.adapter.add("fill", function (fill, target) {
                return (target.dataItem.index >= 0) ? chart.colors.getIndex(target.dataItem.index) : fill;
            });
            categoryAxis.renderer.minGridDistance = 10;

            var valueAxis = chart.xAxes.push(new am4charts.ValueAxis());
            valueAxis.renderer.grid.template.strokeOpacity = 0;
            valueAxis.min = 0;
            valueAxis.max = 100;
            valueAxis.strictMinMax = true;

            // Create series
            var series1 = chart.series.push(new am4charts.RadarColumnSeries());
            series1.dataFields.valueX = "full";
            series1.dataFields.categoryY = "category";
            series1.clustered = false;
            series1.columns.template.fill = new am4core.InterfaceColorSet().getFor("alternativeBackground");
            series1.columns.template.fillOpacity = 0.08;
            series1.columns.template.cornerRadiusTopLeft = 20;
            series1.columns.template.strokeWidth = 0;
            series1.columns.template.radarColumn.cornerRadius = 20;

            var series2 = chart.series.push(new am4charts.RadarColumnSeries());
            series2.dataFields.valueX = "value";
            series2.dataFields.categoryY = "category";
            series2.clustered = false;
            series2.columns.template.strokeWidth = 0;
            series2.columns.template.tooltipText = "{category}:{value}";
            series2.columns.template.radarColumn.cornerRadius = 20;

            series2.columns.template.adapter.add("fill", function (fill, target) {
                return chart.colors.getIndex(target.dataItem.index);
            });

            // Add cursor
            chart.cursor = new am4charts.RadarCursor();
        }); // end am4core.ready()
    }

    $(document).ready(function () {
        let itemsShakhesha = _dataCreation('Shakhesha');
        let itemsahkam = _dataCreation('Ahkam');
        $("#tbodyshakhes").html(_shakhesTemplating(itemsShakhesha));
        $("#tbodyahkam").html(_ahkamTemplating(itemsahkam));

        for (let i = 0; i < itemsahkam.length; i++) {
            const element = itemsahkam[i];
            let chartdiv = 'PieChart_' + (i + 1);
            datachart = [{
                titlechart: "تحقق",
                valuechart: element.realization,
                color: "#28da89",
            }, {
                titlechart: "عدم تحقق",
                valuechart: element.notrealization,
                color: "#ff0000",
            }];
            _variableHeight3DPieChart(chartdiv, datachart);
        }

        var RadarChartData = [];
        for (let i = 0; i < itemsShakhesha.length; i++) {
            const element = itemsShakhesha[i];
            let ObjectchartData = {};
            ObjectchartData.category = element.title;
            ObjectchartData.value = element.realization;
            ObjectchartData.full = 100;
            RadarChartData.push(ObjectchartData);
        }
        _radarChart(RadarChartData);

        var ColumnChartData = [];
        for (let i = 0; i < itemsShakhesha.length; i++) {
            const element = itemsShakhesha[i];
            let ObjectchartData = {};
            ObjectchartData.project = element.title;
            ObjectchartData.progres = element.realization;
            ObjectchartData.color = "#000"
            ColumnChartData.push(ObjectchartData);
        }
        ColumnChart(ColumnChartData);
    });
</script>